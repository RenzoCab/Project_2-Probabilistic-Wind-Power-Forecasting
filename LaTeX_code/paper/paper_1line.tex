\documentclass[11pt]{article}

\usepackage{graphicx}
\usepackage{amssymb, amsmath}
\usepackage{bm} % more powerful version to get bold
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{authblk}

\usepackage[backend=biber, style=apa,autocite=inline]{biblatex} % package for bibliography
\DeclareLanguageMapping{english}{english-apa}

\addbibresource{sdewind.bib}

%\usepackage[backend=biber, style=authoryear,autocite=inline]{biblatex}

\newcommand{\add}{\textcolor{red}{[insert]}}

\setcounter{page}{1}

\begin{document}

\title{ Stochastic Wind Power Forecasting }  % \\  \small{Report}}

%\author[1]{Waled Alhaddad}
\author[1]{Renzo Caballero}
\author[2]{Ahmed Kebaier}
\author[3]{Marco Scavino}
\author[4]{ Ra\'ul  Tempone}
%\author[2]{Corresponding Author\thanks{email@2nduniversity.com}}
\affil[1,4]{CEMSE Division, King Abdullah University of Science and Technology (KAUST), Saudi Arabia}
\affil[2]{Université Paris 13, Sorbonne Paris Cité, LAGA, CNRS (UMR 7539), Villetaneuse, France}
\affil[3]{Universidad de la Rep\'ublica, Instituto de Estad\'{\i}stica (IESTA), Montevideo, Uruguay}
\affil[4]{Alexander von Humboldt Professor, RWTH Aachen University, Germany}

%\author{ Waled Alhaddad \textsuperscript{\textasteriskcentered} \qquad Ahmed Kebaier\textsuperscript{\ddag} \qquad Ra\'ul  Tempone\textsuperscript{\textasteriskcentered}\textsuperscript{\textdagger} \\
%\textsuperscript{\textasteriskcentered}CEMSE Division, King Abdullah University of Science and Technology (KAUST), Saudi Arabia \\ \textsuperscript{\textdagger}Alexander von Humboldt Professor, RWTH Aachen University, Germany
% \\ \textsuperscript{\ddag}Université Paris 13, Sorbonne Paris Cité, LAGA, CNRS (UMR 7539), Villetaneuse, France}

\maketitle
%\thispagestyle{empty}

%%%%%%%%% ABSTRACT

\begin{abstract}

Reliable wind power generation forecasting is crucial for applications such as the allocation of energy reserves, optimization of electricity price and operation scheduling of conventional power plant. We propose a data driven model based on parametric Stochastic Differential Equations (SDEs) to captures real-world asymmetric dynamics of wind power forecast errors. Our SDE framework incorporates time derivative tracking of the forecast, time-dependent mean reversion parameter and an improved diffusion term. We are able to simulate future wind power production paths and to get sharp confidence bands. The method is forecast technology agnostic and enables the comparison between different forecasting technologies on the basis of information criteria. We apply the model to historical Uruguayan wind power production data and forecasts on the year 2019.

\end{abstract}

{\color{red}Keywords: Indirect inference, wind power, probabilistic forecasting, stochastic differential equations, Lamperti transform, model selection.}

{\color{red} Add AMS Classification.}

%%%%%%%%% BODY TEXT


%---BEGIN SECTION 1---
\section{Introduction}  \label{Section_1}

\begin{figure}
\centering
\includegraphics[width=0.9\textwidth]{plots/wind_and_solar/plot_over_years.eps}
\caption{Installed wind and solar power over the years \cite{sultana2017review}. We recall the importance of accurate forecasts to use green energies optimally.}
\end{figure}

Reliable wind power generation forecasting is crucial for the following applications (see, for example, \cite[5]{gieb}, \cite[162]{chang}, \cite{zhbo}):
\begin{itemize}
\item Allocation of energy reserves such as water levels in dams or oil, and gas reserves.
\item Operation scheduling of controlable power plants.
\item Optimization of the price of electricity for different parties such as electric utilities, Transmission system operator (TSOs), Electricity service providers (ESPs), Independent power producers (IPPs), and energy traders.
\item Maintenance planning such as that of power plants components and transmission lines.

\end{itemize}

Different methods have been applied to wind power forecasting. They can be generally categorized as follows: physical models, statistical methods, artificial intelligence methods and hybrid approaches. The output of such methods is usually a deterministic forecast. Occasionally probabilistic forecasts are produced through uncertainty propagation in the data, parameters or through forecast ensembles. {\color{red} Expand discussion about works on probabilistic forecasting.} However, there is a lacking in simulating and producing data driven stochastic forecasts based on real-world performance of forecasting models. It is crucial to capture actual performance of a forecast as it has been known that different forecasting technologies exhibits different behavior for different wind farms and seasons [ref]. This is due to many factors which forecast are challenged to capture such as the surrounding terrains of the wind farm and the condition of the blades such as icing, wear and tear or dirt. It is known that complex terrains in both off shore and on shore locations decrease the accuracy of wind power forecasts significantly [ref]. It also has been shown that the performance of forecasts varies from month to month. Thus the performance of wind power forecasts is location and time dependent.

Many approaches have been taken to evaluate the uncertainty of a given forecast. There are two types of errors: level errors and phase errors. The use of mean or median errors in this context may be misleading as wind power forecast errors are asymmetric. This is a natural consequence of wind power being non-negative and bounded by the maximuim capacity of production. This is important as the associated cost to power forecast errors are also asymmetric due to different costs for up and down  power regulations which are determined by the electricity market [ref].

We propose to model wind power forecasts errors using parametric stochastic differential equations (SDEs) whose solution defines a stochastic process. This resultant stochastic process describes the time evolution dynamics of wind power forecast errors while capturing properties such as a correlation structure and the inherent asymmetry. Additionally, the model we propose is agnostic of the forecasting technology and serves to complement forecasting procedures by providing a data driven stochastic forecast. Hence, we are able to evaluate wind power forecasts according to their real-world performance and we are able to compare different forecasting technologies. Most notably, we are able to simulate future wind power production given a deterministic wind power forecast. Future wind power production using Monte Carlo methods, as well as the analytic form of the proposed SDE, can be used in optimal control problems involving wind power production.

Previous attempt by (\cite{mozuma}) considered stochastic wind power forecast models based on stochastic differential equations. Here, we propose an improved model featuring time derivative tracking of the forecast, time-dependent mean reversion, modified diffusion and non-Gaussian approximations. We apply the model to Uruguayan wind power forecasts together with historical wind power production data pertaining to the year 2019.

{\color{red} Change this paragraph. Discuss with the global dataset, the dataset after removing days when curtailing has been detected, the data set without curtailing and with Lamperti transform.}
We have available a year long data set from Uruguay based on 363 observation paths, each of which is 24-hours long with observations recorded every 10 min. In total, it is a data set of approximately fifty thousand data points recorded in 2019. See Figure (\ref{fig:sample_data}). The data is normalized with respect to the maximuim power capacity of wind power production in Uruguay, which is $\SI{1474}{\mega\watt}$. However, sometimes the real production is artificially modifies due to curtailing. This effect becomes clear when we inspect for different power production levels. We split the available data into a low, meduim and high power range. See Figure (\ref{fig:data_curtailing}).\\
We identify and remove the days with curtailing, removing a total of 108 days. From the resulting 255 days, we use 127 days to train the system and 128 to test it. Also, to avoid correlation between days, we intercalate the days we use for training and testing ({\color{red} Show that 24h is enough to ensure independence}).

In this paper we present the phenomenological underlying model in Section \ref{Section_2} and describe the physical constraints in Section \ref{Section_3} and how these constrains can be met. Then, in Section \ref{Section_4}, we will introduce an alternative formulation of the model in Lamperti space. In Section \ref{Section_5}, we show our parameter estimation procedure and its results in Section \ref{Section_6}. We compare alternative models in Section \ref{Section_7} and different forecast providers in Section \ref{Section_8}.

\begin{figure}
\centering
\includegraphics[width=0.45\textwidth]{plots/5.eps}
\includegraphics[width=0.45\textwidth]{plots/245.eps}\\
\includegraphics[width=0.45\textwidth]{plots/661.eps}
\includegraphics[width=0.45\textwidth]{plots/805.eps}
\caption{Four samples from the Uruguayan data of 2019. Each sample compromises of two 24-hour paths. In blue is an hourly wind power production forecast. In orange is the actual wind power production recorded in 10 minute intervals.}
  \label{fig:sample_data}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.45\textwidth]{plots/LP_6.eps}
\includegraphics[width=0.45\textwidth]{plots/MP_6.eps}\\
\includegraphics[width=0.45\textwidth]{plots/HP_6.eps}
\includegraphics[width=0.45\textwidth]{plots/AP_6.eps}
\caption{We see that forecast errors exhibit skewness, which is exaggerated as a consequence of curtailing in the production. Low power is when produced power is in $[0,0.3]$, mid-power is when it is in $(0.3,0.6]$, and high power when it is in $(0.6,1]$. We have a total of 363 days to use.}
  \label{fig:data_curtailing}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.45\textwidth]{plots/LP.eps}
\includegraphics[width=0.45\textwidth]{plots/MP.eps}\\
\includegraphics[width=0.45\textwidth]{plots/HP.eps}
\includegraphics[width=0.45\textwidth]{plots/AP.eps}
\caption{We observe that skewness has been reduced after removing the days with curtailing. We have a total of 255 days with no curtailing.}
  \label{fig:data_after_clean}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.45\textwidth]{plots/LP_t.eps}
\includegraphics[width=0.45\textwidth]{plots/MP_t.eps}\\
\includegraphics[width=0.45\textwidth]{plots/HP_t.eps}
\includegraphics[width=0.45\textwidth]{plots/AP_t.eps}
\caption{Transitions in error between forecast and real production. We can observe that they are not totally centered around zero.}
\label{fig:error_transitions}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.45\textwidth]{plots/LP_t_LP.eps}
\includegraphics[width=0.45\textwidth]{plots/MP_t_LP.eps}\\
\includegraphics[width=0.45\textwidth]{plots/HP_t_LP.eps}
\includegraphics[width=0.45\textwidth]{plots/AP_t_LP.eps}
\caption{Transitions after the Lamperti transform. The transitions now present a normal Gaussian shape. This effect motivates the use of Gaussian proxies to approximate the process after using the Lamperti transform.}
  \label{fig:LP_transitions}
\end{figure}
%---END SECTION 1---

%---BEGIN SECTION 2---
\section{Phenomenological  Model} \label{Section_2}

We introduce the following phenomenological model. Let $X = \{X_t, \, t>0\}$  be the  wind power generation forecasts stochastic process defined by the following parameterized stochastic differential equation (SDE)

\begin{equation}
  \left\{
  \begin{array}{@{}rl@{}}
    dX_t \!\!\!&=  a(X_t; p_t, \dot{p}_t,\bm{\theta}) \,dt + b (X_t; p_t, \bm{\theta} ) \,dW_t  \\
     X_0  \!\!\!&=  x_0,
  \end{array}\right. \label{eq:main}
\end{equation} 

where

\begin{itemize}
\item $a(\cdot; p_t, \dot{p}_t,\bm{\theta}):[0,1] \to \mathbb{R} \ $  denotes a drift function,
\item $b (\cdot;p_t, \bm{\theta} ):[0,1] \to \mathbb{R} \ $  a  diffusion function,
\item $\bm{\theta}$ is a vector of parameters,
\item $p_t$ is a time-dependent scalar value and $ \dot{p}_t$ is its time derivative at time $t$,
\item $\{W_t, \, t >0\}$ is a standard Wiener process in $\mathbb{R}$.
\end{itemize}

In this work, $p_t$ is to be considered as a deterministic forecast of the wind power generation at time $t$ which is available from an official source. 

Our goal is to provide a specification of the model (\ref{eq:main}) to follow closely the available wind power forecasts while ensuring its unbiasedness with respect to the forecast. It is straightforward to show that $\mathbb{E} \left[X_t\right] = p_t$, where $p_t$ is the available deterministic wind power forecast for the time $t$.

\subsection{Physical Constrains}

Let $p_t$ be a numerical wind power forecast, which is an input to this approach. Assume that the wind power generation forecasts are modeled as solutions to the following It\^{o} stochastic differential equation
\begin{equation}
  \left\{
  \begin{array}{@{}rl@{}}
    dX_t \!\!\!&= \dot{p}_t \ dt - \theta_t (X_t - p_t) \ dt + b (X_t; \bm{\theta} ) \ dW_t\,, \quad t > 0  \\
   X_0  \!\!\!&=  x_0 \,.
 \end{array}\right.  \label{model:derivative_tracking_X}
\end{equation} 

According to the SDE specification in (\ref{model:derivative_tracking_X}), the process $X_t$ satisfies the two following properties: \begin{itemize}
\item it is mean reverting to the wind power forecast $p_t$, and 
\item it tracks the time derivative wind power forecast $\dot{p}_t$.  
\end{itemize} 
Observe that a mean reverting model without derivative tracking exhibits consistent lags, as it is shown in Figure (\ref{fig:derivative_tracking}). See Section \ref{Section_7} for comparisons.

\begin{figure}
  %\includegraphics[width=26mm,scale=1]{}
  \caption{insert figure showing the difference with and without derivative tracking}
  \label{fig:derivative_tracking}
\end{figure}


We normalize the forecast and production data to Uruguay installed power capacity at the time of observation. Thus our process must be limited to the range $[0,1]$. To enforce this constraint, our  drift and diffusion terms  must satisfy certain rules.
 

Let $\bm{\theta} = (\theta_0,\alpha)$. We want a process that follow the wind forecast, thus we choose mean reverting drift term which also tracks the derivative of $p_t$, which is an input to our model.
  \begin{equation}
    a(x; p_t,\bm{\theta})=  \dot{p_t} - \theta_t(x - p_t)
  \end{equation}
where $\theta_t>0$ is a time-dependent parameter that controls the speed of reversion. {\color{red} Derivative tracking does not assure that the paths of the process $X$ take values in $[0,1]$.}


We would like  a diffusion term that vanishes at the boundaries to prevent the process from escaping the region $[0,1]$.
  \begin{equation}
    b (x; p_t,\bm{\theta} )= \sqrt{2 \theta_t \alpha x (1-x)}
  \end{equation}
  where $\alpha >0$ is a constant parameter that controls the path variability. This diffusion term belongs to the Pearson diffusion family and , in particular, it is a Jacobi type diffusion. {\color{red} Add expressions and references for these class of diffusions, for example \cite{iacus1}.}

To further ensure that the process does not escape the region $[0,1]$, the mean reversion parameter has to be selected according to the following rule. Observe that the time derivative term $\dot{p}_t $ is not controlled to maintain that $X_t$ stays a.s.  inside the range $[0,1]$. In other words, the zero drift line defined by $a(x; p_t,\bm{\theta}) =0$, which an attractor, must be contained inside the range $[0,1]$. Thus, we must have that
\begin{equation}
\frac{- |\dot{p_t}|}{p_t} \leq \theta_t \leq \frac{|\dot{p}_t|}{1- p_t}
\end{equation}
which is satisfied  by choosing a time-dependent  $\theta_t$ as follows,
\begin{equation}
\theta_t = \max \left( \theta_0 \ , \ \frac{|\dot{p}_t|}{\min (p_t, 1-p_t)}  \right ),  \quad \theta_0 >0\,. \label{theta_t}
\end{equation}

{\color{red} The expression for $\theta_t$ is important: $\theta_t$ depens on $t$ through $\dot{p_t}$ and $p_t$. Besides it is parsimonious because only one unkonwn parameter appear in \ref{theta_t}. Recall it is an upped bound for the real inequality. } 

\subsubsection*{Change of Variables:}
To avoid differentiation of the forecast $p_t$ and simplify, we apply the change of variables $$V_t = X_t - p_t \,.$$ 

The  model becomes,
\begin{equation}
  \left\{
  \begin{array}{@{}rl@{}}
    dV_t \!\!\!&=  - \theta_t V_t \  dt + \sqrt{2 \theta_t \alpha (V_t +p_t ) (1-V_t-p_t)} \  dW_t   \\ %\quad t > 0
V_0 \!\!\!&=  v_0 \,. \label{VtSDE}
% \theta_t &= \max \left( \theta_0 \ , \ \frac{|\dot{p}_t|}{\min (p_t, 1-p_t)}  \right )\\
\end{array}\right. 
\end{equation}
%---END SECTION 2---


%---BEGIN SECTION 3---
\section{State independent diffusion: Lamperti transform} \label{Section_3}

Our model (\ref{VtSDE}) for the forecast error has a diffusion term that depends on the state variable $V_t$. To estimate the unknown model parameters, a recommended technique is to modify the SDE (\ref{VtSDE}) by applying the so-called Lamperti transform (see \cite[40--41]{iacus1}, \cite{moma}, \cite[98--100]{saso}) to the process $V$ to obtain a SDE for the transformed process whose diffusion term does not depend anymore on the state variable. \\

We consider the following Lamperti transformation  {\color{red} (Remind that in continuous-time models with different diffusion term are singular and the likelihood cannot be written down. Besides, it can be unstable to work with low frequency. If the frequency of the data is too low, the Lamperti transform helps to detect this problem (in principle, it is not clear how to determine the right frequency for estimation. )}
\begin{equation}
Z_t = h(V_t) = \frac{1}{\sqrt{2 \theta_t \alpha}} \int_{\xi}^{x} \frac{1}{\sqrt{(u + p_t)(1 - u - p_t)}} \,du \Bigg{\vert}_{x = V_t} \,,
\end{equation}
where $\xi$ is an arbitrary point of the state space of the process $V$. The choice of $\xi = \frac{1}{2} - p_t$, where $p_t$ is a known input, leads to the process 
\begin{equation}
Z_t = h(V_t) = \frac{1}{\sqrt{2 \theta_t \alpha}} \arcsin (2(V_t + p_t) -1)\,,
\end{equation}
that, after applying It\^{o}'s formula on $h(V_t)$, gives the state-independent diffusion SDE
\begin{equation}
dZ_t = \left[  \frac{- \theta_t V_t}{ \sqrt{2 \theta_t \alpha (V_t + p_t)(1 - V_t - p_t)}} - \frac{1}{4} \frac{\sqrt{2 \theta_t \alpha} \left( 1 - 2 (V_t + p_t)\right)}{\sqrt{(V_t + p_t)(1 - V_t - p_t)}}  \right] \,dt + dW_t \,. \label{eq:stindepSDE}
\end{equation}
After replacing $V_t = \frac{\sin(Z_t) + 1}{2} - p_t$ in (\ref{eq:stindepSDE}), we obtain that the  process $Z$ satisfies the SDE
\begin{equation}
dZ_t = \left[ \frac{- \theta_t (\sin(Z_t) + 1 - 2 p_t)}{\sqrt{2 \theta_t \alpha} \cos{(Z_t)}} + \frac{\sqrt{2 \theta_t \alpha} \sin{(Z_t)}}{2 \cos{(Z_t)}} \right] \,dt + dW_t \,. 
\end{equation}


%\begin{align}
%    dZ_t&= \frac{- \theta_t (1+ \sin(Z_t) - 2p_t) + \alpha \theta_t \sin (Z_t)   }{\cos (Z_t)} \ dt + \sqrt{2 \alpha \theta_t} dW_t \\
%    Z_0&=z_0 \,,
%\end{align}
%where the Lamperti trasform is given by $Z_t = \arcsin \left( \frac{1}{2} \left( V_t+p_t \right) - 1 \right) $. 

We can see in Figure (\ref{fig:skew_after_lamperti}) the effect of the Lamperti transformation upon the forecast error data. 
The Lamperti transformation has greatly reduced the forecast error skewness, ensuring that the process stays in the range $[0,1]$. Therefore, in this case, the transition densities of the process Z can be adequately approximated through Gaussian densities.
%---END SECTION 3---

%---BEGIN SECTION 4---
\section{Likelihood in $V$ space} \label{Section_4}

\subsection{Likelihood}

Suppose that any of $M$ non-overlapping paths of the continuous-time It\^{o} process $V = \{ V_t, t >0 \}$ is sampled at $N$ equispaced discrete points with length interval $\Delta_N$, and let $ V^{M,N}=\{ V_{t_1^{M,N}} , V_{t_2^{M,N}} ,\ldots , V_{t_N^{M,N}} \}$ denote this random sample. 

Let $\rho_i(v \vert v_{j, t_{i-1}} ; \bm{\theta})$ denote the conditional probability density of $V_{j, t_i}$ given $V_{j, t_{i-1}} = v_{j, t_{i-1}}$ evaluated at $v$, where $\bm{\theta} = (\theta_0, \alpha)$ are the unknown model parameters.

The It\^{o} process $V$ defined by the SDE (\ref{VtSDE}) is Markovian, then the likelihood function of the data can be written as the following product of transition densities:  
%Consider the set of $M$ paths with $N$ observations each, $ V^{M,N}=\{ V_{t_1^{M,N}} , V_{t_2^{M,N}} ,\ldots , V_{t_N^{M,N}} \}$, observed in $\Delta_N$ intervals.
\begin{equation}
\mathcal{L}(\bm{\theta},\delta; V^{M,N}) = \prod\limits_{j=1}^M \prod\limits_{i=1}^N \rho ( {V_{j, t_i}| V_{j, t_{i-1}}} ; p_{[t_{i-1}, t_{i}]},  \bm{\theta} )  \, \rho_0 (V_{j, t_0}|V_{j, t_{-\delta}};\bm{\theta},\delta) \,.
\label{likelihood}
\end{equation}

 {\color{red} In \ref{likelihood} modify the expression for $\rho_0$ contemplating the lag, say $\delta$, between the time when the forecast is done and the first time of forecasting. $\rho_0$ can be written as a conditional density between these two times. Once $\theta_0$ and $\alpha$ have been estimated, one could estimate $\delta$.}

The exact computation of the likelihood (\ref{likelihood}) relies on the availability of a closed-form expression for the transition densities of $V$ that, on the basis of the Markovian property of $V$, are characterized, for $ t_{j, i-1} < t < t_{j,i}$,  as solutions of the Fokker-Planck-Kolmogorov equation (\cite[36]{iacus1}, \cite[61-68]{saso}):

\begin{align}
\frac{ \partial f }{\partial t } & \rho_i(v_{j,i} ,t \vert v_{j,i-1} ,  t_{j,i-1} ; \bm{\theta} )= - \frac{\partial}{ \partial v} (- \theta_t v \, \rho_i(v ,t_{j,i} \vert v_{j,i-1} ,  t_{j,i-1} ; \bm{\theta} ) ) \nonumber \\
& + \frac{1}{2} \frac{\partial^2}{ \partial v^2} ( 2 \theta_t \alpha (v+ p_t) (1 - v- p_t) \, \rho_i(v ,t_{j,i} \vert v_{j,i-1} ,  t_{j,i-1} ; \bm{\theta} ) )\,,  \label{eq:fpk}
\end{align}
subject to the initial conditions $\rho_{i-1}(v , t_{j, i-1} , \bm{\theta} ) = \delta(v - V_{j, t_{i-1}}) \,,$ where $ \delta(v - V_{j, t_{i-1}})$ is the Dirac-delta generalized function centered at $ V_{j, t_{i-1}}\,.$

Closed-form solutions to initial-boundary value problem for SDEs can be obtained only in a few cases. Besides, in our case solving numerically (\ref{eq:fpk}) for the transition densities of the process $V$ at every transition step is computationally expensive. 
Therefore, under the likelihood-based inferential paradigma, many techniques have been devised to obtain approximate maximum likelihood estimates for the unknown parameters of continuous-time SDE models with discrete observations. Parametric estimation problems for diffusion processes sampled at discrete times are presented in \autocite[Chapter 3]{iacus1}, and a survey of estimation methods for the parameter vector of the general one-dimensional, time-homogeneous SDE from a single sample of observations at discrete times is presented in \autocite{hurn}.

\subsection{Approximate Likelihood}


A common choice is performing a Gaussian approximation of the transition densities, but this is inappropriate here due to physical constraints which give rise to asymmetric forecasting errors as seen in figure (\ref{fig:skew_data}).\\

We propose a proxy transition density. We match the moments of our SDE model with that of the proxy density. Using It\^o formula, we arrive at the following iterative ODEs for the state dependent diffusion formulation (\ref{VtSDE})
\begin{equation}
\frac{d \mathbb{E}[ V^k_t]}{dt} = - k \theta_t \mathbb{E}[ V^k_t] + \frac{k(k-1)}{2} \mathbb{E}[ V^{k-2}_t  b(V^k_t;\theta_t, \alpha)]
\end{equation}

For $t\in [t_{n-1}, t]$, the first two moments are given by
\begin{align}
\frac{d m_1 (t)}{dt} &= - m_1(t)\theta_t   \nonumber \\
\frac{d m_2 (t)}{dt} &=  -2 m_2(t)\theta_t(1+\alpha) + 2\alpha\theta_t m_1(t)(1-2p_t)  \nonumber \\
&\quad + 2 \alpha\theta_t p_t (1-p_t) \,,
\end{align}
with initial conditions $m_1(t_{n-1})= v_{n-1}$ and $m_2(t_{n-1})= v_{n-1}^2 \,.$

And for the state independent diffusion formulation, similarly, we  obtain a system of ODEs to determine the centered moments of the Lamperti transformed process $V_t$. Due to the non-linearity in the drift, we can only approximate the centered moments by the following ODEs,
\begin{align}
\frac{d m_1 (t)}{dt} &= - m_1(t)\theta_t (1-\alpha) - \theta (1-2 p_t) \nonumber \\
\frac{d var(t)}{dt} &=  2 var(t) \theta_t (2p_t - 1 ) \tan(m_1 (t)) \sec(m_1 (t))   \nonumber \\
& \quad + \theta_t (\alpha - 1) \sec^2(m_1 (t))  + 2 \theta_t \alpha \,.
\end{align}

A suitable candidate for a proxy transition density is a Beta probability distribution as it is compactly supported and can morph into symmetric and asymmetric shapes. {\color{red} Move this sentence to next section.}

\subsubsection*{ Moment Matching}
To approximate the transition densities of  the process $V_t$ by a Beta distribution, we match its moments with the shape parameters $\xi_1, \xi_2$ of a Beta proxy density on $[-1,1]$. The any moment of the process $V_t$ is  given by solving the corresponding ODE system  for the $k^{th}$  moment,

The shape parameters are given by
\begin{equation}
\xi_1 = - \frac{(1+\mu_t )(\mu_t^2 + \sigma_t^2 -1)}{2 \sigma_t^2}\,, \quad \xi_2=  \frac{(\mu_t-1 )(\mu_t^2 + \sigma_t^2 -1)}{2 \sigma_t^2} \,, \label{param_transformed_beta}
\end{equation}
where $\mu_t = m_1 (t)$ and $\sigma_t^2= m_2 (t)- m_1 (t)^2\,.$

\subsection{Optimization} \label{opt_sec}
{\color{red} Rewrite the discussion to obtain fast initial estimate for the two unknow parameters.}

To initialize the optimization process for the likelihood function of the process $V$, we solve the following least-squares problem which gives us first estimates of the mean reversion parameter $\theta_0$: {\color{red} Add explanation regarding the motivation for this objective function.}

\begin{equation}
\theta_0\approx\arg\min_{\theta} \sum\limits_{j}^M \sum\limits_i^N \left( v_{i+1,j}  - v_{i,j}- \left( - \theta_t v_{i,j}\right) \left(t_{i+1,j} - t_{i,j} \right)  \right)^2,
\label{inital_theta}
\end{equation}
 
 where $v_{i,j}=x_{i,j}-p_{i,j}$,  $x_{i,j}$ is historical wind power production and $p_{i,j}$ is the wind power forecast.
 
 By assuming ergodicity {\color{red} not ergodicity, instead simply for the quadratic variation formula.}, we can obtain a first estimate on the product of the parameters as follows,
 
\begin{equation}
\theta_0 \alpha \approx \frac{1}{2M\Delta t} \sum\limits_j^M \frac{ \sum\limits_i^N (x_{i+1,j}  - x_{i,j})^2}{ \sum\limits_i^N x_{i,j}(1-x_{i,j}) } \,.
\end{equation}

Solving for $\alpha$, we have both first estimates and we can also estimate $\delta$ solving the problem


\begin{equation}
\delta\approx\arg\min_{\delta}\mathcal{L}_{\delta}(\bm{\theta},\delta; V^{M,1}) = \arg\min_{\delta}\prod\limits_{j=1}^M \rho_0 (V_{j, t_0}|V_{j, t_{-\delta}};\bm{\theta},\delta) \,.
\label{likelihood_delta}
\end{equation}

With our estimations of $\bm{\theta}$, we can start the inference processes as follows:
\begin{enumerate}
\item[Step 1.]  initialize;
\item[Step 2.]  optimize the log-likelihood function using  Nelder-Mead optimization algorithm on a mini-batch sampled with replacement;
\item[Step 3.] check if  accuracy threshold is reached. Else, re-initialize the optimization with the most recent result on a larger mini-batch.
\end{enumerate}
%---END SECTION 4---

%---BEGIN SECTION 5---
\section{Model Comparison} \label{Section_5}

We compare two candidate models to find the best-fit that maximizes the retained information,
\begin{itemize}
  \item Model 1: This model does not feature derivative tracking.
  \begin{align}
  dX_t &=  - \theta_0 (p_t-X_t) \  dt + \sqrt{2 \theta \alpha X_t (1-X_t)} \  dW_t   \nonumber \\ %\quad t > 0
  X_0 & = x_0 \,, \label{M0}
 \end{align}
  with $\theta_t= \theta_0 $.

%  \item Model 1: This model features derivative tracking, i.e. it is equivalent to (\ref{model:derivative_tracking_X}) with a diffusion term that is forecast dependent by including the term $p_t(1-p_t)$.
%  \begin{equation}
%  \begin{split}
%  dV_t &=  - \theta_t V_t \  dt + \sqrt{2 \theta_t \alpha p_t(1-p_t)(V_t +p_t ) (1-V_t-p_t)} \  dW_t  \\ %\quad t > 0
%  V_0 & = v_0
%  \end{split}\label{M2}
%  \end{equation}
%  with $\theta_t$ given by (\ref{theta_t}). This model has been used by [ insert ref ] and [ insert ref ]. Initial interest in this model stems from interest in long-term stationary solution, which may exists  if the forecast is constant. However, this is almost never occurs and thus including the term $p_t(1-p_t)$ is irrelevant. Additionally, the term $p_t(1-p_t)$ leads the model to become deterministic when the forecast is at the boundaries (i.e.$p=1$ or $p=0$)  which is not realistic. We have run computations on this model and the results were not satisfactory. Therefore, we exclude this model from further discussions.
%  

  \item Model 2: This model features derivative tracking, i.e. it is equivalent to (\ref{model:derivative_tracking_X}).
  \begin{align}
  dV_t &=  - \theta_t V_t \  dt + \sqrt{2 \theta_t \alpha (V_t +p_t ) (1-V_t-p_t)} \  dW_t   \nonumber \\ %\quad t > 0
  V_0 & = v_0 \,, \label{M2}
  \end{align}
  with $\theta_t$ given by (\ref{theta_t}).
\end{itemize}

\begin{table}
\centering
\begin{tabular}{cccc}
\toprule
Model   &  parameters $(\theta_0, \alpha,\delta)$   & AIC & BIC \\ \midrule
Model 1 &  $(\add,\add) $    &  \add   &  \add   \\
Model 2 &   $(1.2,0.1,0.6)$   &  \add   &   \add    \\ 
\bottomrule
\end{tabular}
\caption{We compare the different models based on information criterion. \add }
\label{tab:model_comparison}
\end{table}
%---END SECTION 5---

%---BEGIN SECTION 6---
\section{Forecast Provider Comparison} \label{Section_6}
We compare forecasts from two different companies for the same period.
\begin{table}
\centering
\begin{tabular}{cccc}
\toprule
Forecast Provider & parameters $(\theta_0, \alpha,\delta)$ & AIC & BIC \\ \midrule
Provider A  &  $(\add,\add)$      &  \add   & \add    \\
Provider B  & $(\add,\add) $  &  \add   &   \add  \\ 
\bottomrule
\end{tabular}
\caption{\add}
\label{tab:forcast_comparison}
\end{table}
In Figure (\add)-(\add), we see that forecast provider A is of better quality than provider B. This is confirmed by both the AIC and BIC information criteria.

 \begin{table}[h]
 \centering
 \begin{tabular}{cccc}
 \toprule
 Model & parameters $(\theta_0, \alpha)$  \\
 \midrule
 \begin{tabular}[c]{@{}c@{}}low frequency data\\ (hourly)\end{tabular}               &  $(\add,\add) \pm (\add,\add)$   \\ 
 \begin{tabular}[c]{@{}c@{}}high frequency data\\  (every 10 minutes)\end{tabular} &  $(\add,\add) \pm (\add,\add)$      \\ \bottomrule
 \end{tabular}
 \caption{ \add confidence interval obtained using bootstrap}
 \label{tab:freq_comparison}
 \end{table}
%---END SECTION 6---

%---BEGIN SECTION 7---
\section{Results} \label{Section_7}

\subsection{Initial guesses}

Following the instruction for the initial guesses from section $\ref{opt_sec}$, we get the initial guesses $(\theta_0,\alpha,\delta)\approx(1.2,0.1,0.6)$.

\begin{figure}[h!]
\centering
\includegraphics[width=0.45\textwidth]{plots/initial_guess/initial_theta_1.eps}\quad\includegraphics[width=0.42\textwidth]{plots/initial_guess/initial_theta_2.eps}
\caption{Value function from ($\ref{inital_theta}$) as a function of different $\theta_0$ values. We can observe that the function if flat for a wide range.}
\end{figure}

\subsection{Negative Log-Lihelihood}

We plot the Negative Log-Likelihood as a function of the parameters. The plots can be seen in Figure (\ref{fig:neg-LL}). We used all the training data (127 days of data) to construct and optimize the Negative Log-Likelihood.

\begin{figure}[h!]
\centering
\includegraphics[width=0.6\textwidth]{plots/likelihood/Log-Likelihood.eps}\quad\includegraphics[width=0.6\textwidth]{plots/likelihood/Log-Likelihood_refined.eps}
\includegraphics[width=0.6\textwidth]{plots/likelihood/Log-Likelihood_more_refined.eps}
\caption{Negative Log-Likelihood for different domains.}
\label{fig:neg-LL}
\end{figure}

\subsection{Main guesses}

We were able to obtain the following for 
\begin{table}[]
\centering
\begin{tabular}{|c|c|}
\hline
Formulation   &  parameters $(\theta_0, \alpha,\delta)$    \\ \hline
Without Lamperti transform &   $(1.2,0.1,0.6) \pm (\add , \add) $   \\ \hline
With Lamperti transform &   $(12,0.29) \pm (\add , \add)  $   \\ \hline
\end{tabular}
\caption{We compare the parameters obtained in both the original and Lamperti space. Parameters have been obtained based on \add data points from the Uruguayan pertaining to the year 2019\add .}
\label{tab:model_comparison_2}
\end{table}

{\color{red} Remind that Lamperti transform has the purpose tho check the consistency of the models (if the estimation of $\bm{\theta}$ with $V$ and $Z$ differs it is alarming.)}

{\color{red} Discuss to which extent it is needed more accuracy in the estimation of $\bm{\theta}$. How many data we need to achive enough accuracy for the estimates of the two parameters? Generally, such accuracy is application dependent}

 We are able to obtain the parameters based on the complete data sets. Using the different models variations, we are able to simulate wind power production given a forecast. We see in figures ()-()
five possible wind power production paths for each model.\\

In Figures ()-(), we show point-wise empirical confidence bands for the different models.

\begin{figure}
  \includegraphics[width=56mm,scale=1]{plots/alpha_conv_beta.png}
  \includegraphics[width=56mm,scale=1]{plots/theta_conv_beta.png}
  \caption{We show self-convergence of our algorithm applied to model $2$. We conlcude that the rate  matches that of of Monte Carlo. Data is from Uruguay pertaining to year 2019.}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=0.45\textwidth]{plots/paths_testing_days/1.eps}
\includegraphics[width=0.45\textwidth]{plots/paths_testing_days/2.eps}\\
\includegraphics[width=0.45\textwidth]{plots/paths_testing_days/3.eps}
\includegraphics[width=0.45\textwidth]{plots/paths_testing_days/4.eps}
\caption{We simulate following model 2  five possible future wind power production paths using the obtained optimal parameters $(\theta_0, \alpha ,\delta)=(1.2,0.1,0.6)$. Forecast is from Uruguay pertaining to  year 2019.}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=0.45\textwidth]{plots/bands_testing_days/1.eps}
\includegraphics[width=0.45\textwidth]{plots/bands_testing_days/2.eps}\\
\includegraphics[width=0.45\textwidth]{plots/bands_testing_days/3.eps}
\includegraphics[width=0.45\textwidth]{plots/bands_testing_days/4.eps}
\caption{{\color{red}Pending add legend and choose better colors.}We obtain confidence intervals following model 2  for future wind power production using the obtained optimal parameters $(\theta_0, \alpha ,\delta)=(1.2,0.1,0.6)$. Actual production plotted in retrospect. Forecast and data is from Uruguay pertaining to  year 2019.}
\end{figure}
%---END SECTION 7---

%---BEGIN SECTION 8---
\section{Conclusions} \label{Section_8}

We have proposed a method to produce stochastic wind power forecasts based on parametric SDEs. This method is agnostic of the wind power forecasting technology. Using this method, we were able to simulate future wind power production paths and obtain confidence bands. We conclude that Model 2 is a best-fit model. It features time-derivative tracking of the forecast, time-dependent mean reversion parameter, and a more natural diffusion term. Moreover, the model preserves the asymmetry of wind power forecast errors and their correlation structure.

We were also able to compare two different forecast providers with respect to their real-world performance on the aggregated data set and on specific wind farm sites. Finally, the model paves the way for stochastic optimal control methods enabling optimal decision making under uncertainty.
%---END SECTION 7---

%---REFERENCES---

\nocite{*}
 
%\printbibliography
\printbibliography[keyword={Wind-SDE},title={References}]

\end{document}

