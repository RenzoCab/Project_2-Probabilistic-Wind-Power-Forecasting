<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of histogram_lamperti_SDE</title>
  <meta name="keywords" content="histogram_lamperti_SDE">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">.</a> &gt; histogram_lamperti_SDE.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for .&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>histogram_lamperti_SDE
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="lamperti_transform.html" class="code" title="function [val] = lamperti_transform(theta_0,alpha,v,p,candidate)">lamperti_transform</a>	29/03/2020 17:49</li><li><a href="load_data_eps_test.html" class="code" title="function [Table_Testing_Complete] = load_data_eps_test(ep,dataSet,dataKind,set_type)">load_data_eps_test</a>	18/03/2020 10:41</li><li><a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="sde_Lamperti_FE.html" class="code" title="function sim_path_f = sde_Lamperti_FE(sim_path_i,alpha,theta_0,Theta_t,dt,P,P_dot,candidate)">sde_Lamperti_FE</a>	03/04/2020 20:37</li><li><a href="theta_t.html" class="code" title="function [theta_t] = theta_t(theta_0, alpha, pe, pe_dot) % 13/03/2020 19:09">theta_t</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_download"></a>DOWNLOAD <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<p><a href="histogram_lamperti_SDE.m">histogram_lamperti_SDE.m</a></p>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 close all;
0002 clear all;
0003 clc;
0004 
0005 epsilon                = 0.018;
0006 dataKind               = <span class="string">'comparable'</span>;
0007 dataSet                = <span class="string">'MTLOG'</span>;
0008 Table_Testing_Complete = <a href="load_data_eps_test.html" class="code" title="function [Table_Testing_Complete] = load_data_eps_test(ep,dataSet,dataKind,set_type)">load_data_eps_test</a>(epsilon,dataSet,dataKind);
0009 <span class="comment">% whatToDo               = 'Optimal';</span>
0010 whatToDo               = <span class="string">'Optimal_Lamperti'</span>; 
0011 
0012 <span class="comment">% PARAMETERS:</span>
0013 <span class="comment">% set(0,'defaultAxesFontSize',18);</span>
0014 save     = 0;
0015 delta    = 21; <span class="comment">% The time is delta*10 minutes.</span>
0016 numPaths = 1;
0017 
0018 <span class="keyword">if</span>  strcmp(whatToDo,<span class="string">'Optimal'</span>)
0019     theta_0 = 1.18;
0020     alpha   = 0.07;
0021 <span class="keyword">elseif</span>  strcmp(whatToDo,<span class="string">'Optimal_Lamperti'</span>)
0022     theta_0 = 2.200;
0023     alpha   = 0.038;
0024 <span class="keyword">else</span>
0025     error(<span class="string">'Wrong whatToDo script!'</span>);
0026 <span class="keyword">end</span>
0027 
0028 Z_inf = <a href="lamperti_transform.html" class="code" title="function [val] = lamperti_transform(theta_0,alpha,v,p,candidate)">lamperti_transform</a>(theta_0,alpha,0,0,2);
0029 Z_sup = <a href="lamperti_transform.html" class="code" title="function [val] = lamperti_transform(theta_0,alpha,v,p,candidate)">lamperti_transform</a>(theta_0,alpha,1,0,2);
0030 Z_100 = (Z_sup-Z_inf)/100;
0031 
0032 d  = Table_Testing_Complete.Date;
0033 p  = Table_Testing_Complete.Forecast;
0034 t  = Table_Testing_Complete.Time(1,:);
0035 x  = Table_Testing_Complete.Real_ADME;
0036 v  = Table_Testing_Complete.Error;
0037 dt = t(2); <span class="comment">% This is the default dt. I will choose a smaller one.</span>
0038 <span class="comment">% If the dt is not small enough, we always scape from [0 1].</span>
0039 dt = dt/1;
0040 
0041 minus_t = linspace(-delta*dt,-dt,delta);
0042 exten_t = [minus_t,t];
0043 
0044 <span class="keyword">for</span> i = 1 : height(Table_Testing_Complete)
0045 
0046     X = x(i,:);
0047     P = p(i,:);
0048     Z = <a href="lamperti_transform.html" class="code" title="function [val] = lamperti_transform(theta_0,alpha,v,p,candidate)">lamperti_transform</a>(theta_0,alpha,X-P,P,2);
0049     
0050     P_exten_linear = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'linear'</span>,<span class="string">'extrap'</span>);
0051     P              = [P_exten_linear,P]; <span class="comment">% We extend the forecast.</span>
0052     <span class="keyword">for</span> j = 1:length(P)
0053         P(j) = max(P(j),epsilon);
0054         P(j) = min(P(j),1-epsilon);
0055     <span class="keyword">end</span>
0056     Z_P = <a href="lamperti_transform.html" class="code" title="function [val] = lamperti_transform(theta_0,alpha,v,p,candidate)">lamperti_transform</a>(theta_0,alpha,P,0,2);
0057 <span class="comment">%     Z_P is the Lamperti transform of the forecast.</span>
0058 
0059     P_dot   = (-P(1:end-1) + P(2:end)) / dt; <span class="comment">% This starts at 1 end ends at (end - 1).</span>
0060     <span class="keyword">for</span> j = 1:length(P)-1
0061         Theta_t(j) = <a href="theta_t.html" class="code" title="function [theta_t] = theta_t(theta_0, alpha, pe, pe_dot) % 13/03/2020 19:09">theta_t</a>(theta_0, alpha, P(j), P_dot(j));
0062     <span class="keyword">end</span>
0063     
0064     <span class="comment">% We assume that the forecast is perfect one hour before it starts.</span>
0065     sim_path(1:numPaths,1) = Z_P(1);
0066     
0067     <span class="keyword">for</span> k = 1:numPaths
0068         <span class="keyword">for</span> j = 1 : length(exten_t)-1
0069             
0070             sim_path(k,j+1) = <a href="sde_Lamperti_FE.html" class="code" title="function sim_path_f = sde_Lamperti_FE(sim_path_i,alpha,theta_0,Theta_t,dt,P,P_dot,candidate)">sde_Lamperti_FE</a>(sim_path(k,j),alpha,theta_0,Theta_t(j),dt,P(j),P_dot(j),2);            
0071             <span class="keyword">if</span> sim_path(k,j+1) &gt;= Z_sup - Z_100 * 5
0072                 sim_path(k,j+1) = sim_path(k,j);
0073             <span class="keyword">elseif</span> sim_path(k,j+1) &lt;= Z_inf + Z_100 * 5
0074                 sim_path(k,j+1) = sim_path(k,j);
0075             <span class="keyword">end</span>
0076             
0077         <span class="keyword">end</span>
0078     <span class="keyword">end</span>
0079     
0080     z_trans(i,:) = Z(2:end) - Z(1:end-1);
0081     s_trans(i,:) = sim_path(delta+2:end) - sim_path(delta+1:end-1);
0082     
0083     <span class="comment">% Next transformation:</span>
0084     <span class="keyword">for</span> n = 2:length(Z)-1
0085     
0086         <span class="comment">% The first transition is from 1 to 2 because we use information</span>
0087         <span class="comment">% in time 0 to construct it.</span>
0088         Delta_new_Transform(n-1) = (Z(n+1)-2*Z(n)+Z(n-1)) / sqrt(dt);
0089         
0090     <span class="keyword">end</span>
0091     <span class="keyword">for</span> n = 2:length(Z)
0092         new_Transform(n-1) = (Z(n)-Z(n-1)) / sqrt(dt);
0093     <span class="keyword">end</span>
0094     
0095     new_Transform_trans(i,:)   = Delta_new_Transform;
0096     new_Transform_allData(i,:) = new_Transform;
0097         
0098 <span class="keyword">end</span>
0099 
0100 <span class="comment">% figure('Renderer', 'painters', 'Position', [10 10 1500 900]);</span>
0101 figure;
0102 h1 = histogram(z_trans);
0103 hold on; grid minor;
0104 title(<span class="string">'Lamperti (Data and Simulated) Transitions'</span>);
0105 h2 = histogram(s_trans);
0106 h1.Normalization = <span class="string">'pdf'</span>;
0107 h2.Normalization = <span class="string">'pdf'</span>;
0108 h2.FaceAlpha = 0;
0109 h2.FaceColor = [0 0 0];
0110 h2.LineWidth = 2;
0111 h2.EdgeColor = <span class="string">'r'</span>;
0112 xlim([-0.5 0.5]);
0113 xlabel(<span class="string">'Value of Transition'</span>);
0114 ylabel(<span class="string">'Probability'</span>);
0115 <span class="comment">% xlim([-0.4 0.4]);</span>
0116 <span class="comment">% xlim([-1 1]);</span>
0117 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'FontSize'</span>,12);
0118 legend(<span class="string">'Lamperti Transitions Histogram'</span>,<span class="string">'Simulated Lamperti Transitions Histogram'</span>);
0119 saveas(gcf,[pwd <span class="string">'/Results/histograms/lamperti/'</span>,whatToDo],<span class="string">'epsc'</span>);
0120 
0121 <span class="comment">% figure('Renderer', 'painters', 'Position', [10 10 1500 900]);</span>
0122 figure;
0123 h3 = histogram(new_Transform_allData);
0124 h3.Normalization = <span class="string">'pdf'</span>;
0125 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'FontSize'</span>,12);
0126 disp([<span class="string">'Mean of the second transformation: '</span>,num2str(mean(new_Transform_trans(:)))]);
0127 disp([<span class="string">'Variance of the second transformation: '</span>,num2str(var(new_Transform_trans(:)))]);</pre></div>
<hr><address>Generated on Sun 19-Jul-2020 13:36:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>