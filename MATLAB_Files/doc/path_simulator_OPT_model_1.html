<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of path_simulator_OPT_model_1</title>
  <meta name="keywords" content="path_simulator_OPT_model_1">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">.</a> &gt; path_simulator_OPT_model_1.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for .&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>path_simulator_OPT_model_1
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>	ciplot(lower,upper)</li><li><a href="load_data_eps_test.html" class="code" title="function [Table_Testing_Complete] = load_data_eps_test(ep,dataSet,dataKind,set_type)">load_data_eps_test</a>	18/03/2020 10:41</li><li><a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="theta_t.html" class="code" title="function [theta_t] = theta_t(theta_0, alpha, pe, pe_dot) % 13/03/2020 19:09">theta_t</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 close all;
0002 clear all;
0003 clc;
0004 
0005 <span class="comment">% dataSet can be AWSTP (B), MTLOG (A) or UTEP5 (C).</span>
0006 dataSet  = <span class="string">'MTLOG'</span>;
0007 <span class="comment">% epsilon can be 0.035 (B), 0.020 (A) or 0.028 (C).</span>
0008 epsilon  = 0.020;
0009 dataKind = <span class="string">'comparable'</span>;
0010 Table_Testing_Complete = <a href="load_data_eps_test.html" class="code" title="function [Table_Testing_Complete] = load_data_eps_test(ep,dataSet,dataKind,set_type)">load_data_eps_test</a>(epsilon,dataSet,dataKind);
0011 
0012 <span class="comment">% PARAMETERS:</span>
0013 <span class="comment">% set(0,'defaultAxesFontSize',18);</span>
0014 quantil  = 1;
0015 save     = 1;
0016 delta    = 22; <span class="comment">% The time is delta*10 minutes.</span>
0017 xlimit   = 1; <span class="comment">% If this in 1, the plots start at time 0. Otherwise, at -delta.</span>
0018 norm_lim = 0; <span class="comment">% If 1, x=[0,1], if 0, x=[1PM 1PM].</span>
0019 new_time = [13-(1/6)*delta:1/6:37]/24;
0020 new_ti   = [1:1/6:25];
0021 angle    = 45;
0022 
0023 <span class="keyword">if</span> quantil
0024     numPaths = 5000;
0025 <span class="keyword">else</span>
0026     numPaths = 5;
0027 <span class="keyword">end</span>
0028 
0029 <span class="comment">% (A) Theta = 0.02081, Alpha = 4.4421, eps = 0.018, prod = 0.0924, f = -52305.</span>
0030 <span class="comment">% (B) Theta = 0.02584, Alpha = 3.7390, eps = 0.035, prod = 0.0966, f = -30347.</span>
0031 <span class="comment">% (C) Theta = 0.02479, Alpha = 3.9996, eps = 0.028, prod = 0.0992, f = -50455.</span>
0032 
0033 theta = 1.2201/1.12201*1.93;
0034 alpha = 0.075142/1.93*1.12201;
0035 
0036 d  = Table_Testing_Complete.Date;
0037 p  = Table_Testing_Complete.Forecast;
0038 t  = Table_Testing_Complete.Time(1,:);
0039 x  = Table_Testing_Complete.Real_ADME;
0040 v  = Table_Testing_Complete.Error;
0041 dt = t(2); <span class="comment">% This is the default dt. I will choose a smaller one.</span>
0042 <span class="comment">% If the dt is not small enough, we always scape from [0 1].</span>
0043 dt = dt/1;
0044 
0045 figure(10);
0046 
0047 minus_t = linspace(-delta*dt,-dt,delta);
0048 <span class="keyword">if</span> norm_lim == 1
0049     exten_t = [minus_t,t];
0050 <span class="keyword">elseif</span> norm_lim == 0
0051     exten_t = new_time;
0052     t       = [13:1/6:37]/24;
0053     t_ticks = [13:2:37]/24;
0054 <span class="keyword">end</span>
0055 
0056 <span class="keyword">for</span> i = 1 : height(Table_Testing_Complete)
0057 
0058     X = x(i,:);
0059     P = p(i,:);
0060     <span class="comment">% All of them show similar results:</span>
0061     P_exten_linear = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'linear'</span>,<span class="string">'extrap'</span>);
0062     P_exten_pchip  = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'pchip'</span>,<span class="string">'extrap'</span>);
0063     P_exten_spline = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'spline'</span>,<span class="string">'extrap'</span>);
0064     P_exten_makima = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'makima'</span>,<span class="string">'extrap'</span>);
0065     
0066     P       = [P_exten_linear,P]; <span class="comment">% We extend the forecast.</span>
0067     <span class="keyword">for</span> j = 1:length(P)
0068         P(j) = max(P(j),epsilon);
0069         P(j) = min(P(j),1-epsilon);
0070     <span class="keyword">end</span>
0071     P_dot   = (-P(1:end-1) + P(2:end)) / dt; <span class="comment">% This starts at 1 end ends at (end - 1).</span>
0072     <span class="keyword">for</span> j = 1:length(P)-1
0073         Theta_t(j) = <a href="theta_t.html" class="code" title="function [theta_t] = theta_t(theta_0, alpha, pe, pe_dot) % 13/03/2020 19:09">theta_t</a>(theta, alpha, P(j), P_dot(j));
0074     <span class="keyword">end</span>
0075     
0076     <span class="comment">% We assume that the forecast is perfect one hour before it starts.</span>
0077     sim_path(1:numPaths,1) = P(1);
0078 
0079     <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(0,<span class="string">'CurrentFigure'</span>,10); clf(10);
0080     J = plot(exten_t,P); J.LineWidth = 2;
0081     hold on;
0082     J = plot(t,X); J.LineWidth = 2;
0083     xlim([min(exten_t) max(exten_t)]); ylim([0 1]); grid minor;
0084     xlabel(<span class="string">'Time'</span>), ylabel(<span class="string">'Power'</span>);
0085     date = d(i);
0086     
0087     date_format = datetime(date{1},<span class="string">'InputFormat'</span>,<span class="string">'yyyyMMdd'</span>);
0088     date_format_next = date_format + days(1);
0089     title([datestr(date_format),<span class="string">' and '</span>,datestr(date_format_next)]);
0090     
0091     <span class="keyword">for</span> k = 1:numPaths
0092         <span class="keyword">for</span> j = 1 : length(exten_t)-1
0093             sim_path(k,j+1) = sim_path(k,j) + (-theta*(sim_path(k,j)-P(j)))*dt +<span class="keyword">...</span>
0094                 sqrt(dt)*sqrt(2*theta*alpha*sim_path(k,j)*(1-sim_path(k,j)))*randn(1);
0095             <span class="keyword">if</span> sim_path(k,j+1) &gt; 1
0096                 sim_path(k,j+1) = 1;
0097             <span class="keyword">elseif</span> sim_path(k,j+1) &lt; 0
0098                 sim_path(k,j+1) = 0;
0099             <span class="keyword">end</span>
0100         <span class="keyword">end</span>
0101     <span class="keyword">end</span>
0102     
0103     <span class="keyword">if</span> quantil == 1
0104         
0105         <span class="keyword">if</span> norm_lim == 1
0106         
0107             <span class="keyword">for</span> k = 1:length(sim_path(1,:))
0108                 quant(k,:) = quantile(sim_path(:,k),[0.01 0.05 0.25 0.75 0.95 0.99]);
0109                 men(k)     = mean(sim_path(:,k));
0110             <span class="keyword">end</span>
0111             <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(0,<span class="string">'CurrentFigure'</span>,10); clf(10); hold on;
0112             <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,1),quant(:,6),exten_t,[153 255 153]/255)
0113             <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,2),quant(:,5),exten_t,[153 255 255]/255)
0114             <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,3),quant(:,4),exten_t,[153 153 255]/255)
0115             J = plot(exten_t,P,<span class="string">'k'</span>); J.LineWidth = 2;
0116             J = plot(t,X,<span class="string">'b'</span>); J.LineWidth = 2;
0117             legend({<span class="string">'99% confidence interval'</span>, <span class="string">'90% confidence interval'</span>, <span class="string">'50% confidence interval'</span>,<span class="keyword">...</span>
0118                 <span class="string">'Forecast'</span>, <span class="string">'Real production'</span>});
0119             
0120             <span class="keyword">if</span> xlimit == 1
0121                 xlim([0 max(exten_t)]);
0122             <span class="keyword">elseif</span> xlimit == 0
0123                 xlim([min(exten_t) max(exten_t)]);
0124             <span class="keyword">end</span>
0125             
0126             ylim([0 1]); grid minor;
0127             xlabel(<span class="string">'Time'</span>), ylabel(<span class="string">'Power'</span>); box;
0128             date_format = datetime(date{1},<span class="string">'InputFormat'</span>,<span class="string">'yyyyMMdd'</span>);
0129             date_format_next = date_format + days(1);
0130             title([datestr(date_format),<span class="string">' and '</span>,datestr(date_format_next)]);
0131             <span class="keyword">if</span> save == 1
0132                 saveas(gcf,[pwd <span class="string">'/Results/bands_testing_days/model_1/'</span>,num2str(i)],<span class="string">'epsc'</span>);
0133             <span class="keyword">end</span>
0134         
0135         <span class="keyword">elseif</span> norm_lim == 0
0136             
0137             <span class="keyword">for</span> k = 1:length(sim_path(1,:))
0138                 quant(k,:) = quantile(sim_path(:,k),[0.01 0.05 0.25 0.75 0.95 0.99]);
0139                 men(k)     = mean(sim_path(:,k));
0140             <span class="keyword">end</span>
0141             <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(0,<span class="string">'CurrentFigure'</span>,10); clf(10); hold on;
0142             <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,1),quant(:,6),exten_t,[153 255 153]/255)
0143             <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,2),quant(:,5),exten_t,[153 255 255]/255)
0144             <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,3),quant(:,4),exten_t,[153 153 255]/255)
0145             J = plot(exten_t,P,<span class="string">'k'</span>); J.LineWidth = 2;
0146             J = plot(t,X,<span class="string">'b'</span>); J.LineWidth = 2;
0147             legend({<span class="string">'99% confidence interval'</span>, <span class="string">'90% confidence interval'</span>, <span class="string">'50% confidence interval'</span>,<span class="keyword">...</span>
0148                 <span class="string">'Forecast'</span>, <span class="string">'Real production'</span>});
0149 <span class="comment">%             legend({'99% confidence interval', '90% confidence interval', '50% confidence interval',...</span>
0150 <span class="comment">%                 'Forecast', 'Real production'},'location','southeast');</span>
0151 
0152             
0153             xticks(t_ticks);
0154             datetick(<span class="string">'x'</span>,<span class="string">'HHPM'</span>,<span class="string">'keepticks'</span>);
0155             xtickangle(angle);
0156             
0157             <span class="keyword">if</span> xlimit
0158                 xlim([min(t_ticks) max(t_ticks)]);
0159             <span class="keyword">else</span>
0160                 xlim([min(new_time) max(new_time)]);
0161             <span class="keyword">end</span>
0162             
0163             ylim([0 1]); grid minor;
0164 <span class="comment">%             xlabel('Time'), ylabel('Power');</span>
0165             box;
0166             date = d(i);
0167             date_format = datetime(date{1},<span class="string">'InputFormat'</span>,<span class="string">'yyyyMMdd'</span>);
0168             date_format_next = date_format + days(1);
0169             title([datestr(date_format),<span class="string">' and '</span>,datestr(date_format_next)]);
0170             <span class="keyword">if</span> save == 1
0171                 saveas(gcf,[pwd <span class="string">'/Results/bands_testing_days/model_1/withDate/'</span>,num2str(i)],<span class="string">'epsc'</span>);
0172             <span class="keyword">end</span>
0173             
0174         <span class="keyword">end</span>
0175         
0176     <span class="keyword">elseif</span> quantil == 0
0177         
0178         <span class="keyword">if</span> norm_lim == 1
0179             
0180             plot(exten_t,sim_path,<span class="string">'r'</span>);
0181             legend(<span class="string">'Forecast'</span>,<span class="string">'Real Production'</span>,<span class="string">'Simulations'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
0182             <span class="keyword">if</span> xlimit
0183                 xlim([0 max(exten_t)]);
0184             <span class="keyword">else</span>
0185                 xlim([min(exten_t) max(exten_t)]);
0186             <span class="keyword">end</span>
0187             box;
0188             pause(0.1); box;
0189             <span class="keyword">if</span> save == 1
0190                 saveas(gcf,[pwd <span class="string">'/Results/paths_testing_days/model_1/'</span>,num2str(i)],<span class="string">'epsc'</span>);
0191             <span class="keyword">end</span>
0192         
0193         <span class="keyword">elseif</span> norm_lim == 0
0194             
0195             plot(new_time,sim_path,<span class="string">'r'</span>);
0196             legend(<span class="string">'Forecast'</span>,<span class="string">'Real Production'</span>,<span class="string">'Simulations'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
0197             box;
0198             
0199             xticks(t_ticks);
0200             datetick(<span class="string">'x'</span>,<span class="string">'HHPM'</span>,<span class="string">'keepticks'</span>);
0201             xtickangle(angle);
0202             
0203             pause(0.1); box;
0204             <span class="keyword">if</span> xlimit
0205                 xlim([min(t_ticks) max(t_ticks)]);
0206             <span class="keyword">else</span>
0207                 xlim([min(new_time) max(new_time)]);
0208             <span class="keyword">end</span>
0209 
0210             <span class="keyword">if</span> save == 1
0211                 saveas(gcf,[pwd <span class="string">'/Results/paths_testing_days/model_1/withDate/'</span>,num2str(i)],<span class="string">'epsc'</span>);
0212             <span class="keyword">end</span>
0213             
0214         <span class="keyword">end</span>
0215         
0216     <span class="keyword">end</span>
0217     
0218     pause(0.1);
0219     
0220 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 15-Aug-2020 22:53:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>