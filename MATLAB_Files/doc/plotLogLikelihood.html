<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of plotLogLikelihood</title>
  <meta name="keywords" content="plotLogLikelihood">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">.</a> &gt; plotLogLikelihood.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for .&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>plotLogLikelihood
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="batch_with_theta.html" class="code" title="function [batch_theta] = batch_with_theta(batch, alpha, theta_0) % 09/02/2020 18:51">batch_with_theta</a>	</li><li><a href="batch_with_theta_L.html" class="code" title="function [batch_theta] = batch_with_theta_L(batch, alpha, theta_0) % 29/03/2020 19:43">batch_with_theta_L</a>	</li><li><a href="create_samples_minus_eps.html" class="code" title="function [minus_eps_samples] = create_samples_minus_eps(Forecast, Error, gamma)">create_samples_minus_eps</a>	15/03/2020 21:07</li><li><a href="initial_guess.html" class="code" title="function [est] = initial_guess(real_prod, M, N, dt)">initial_guess</a>	09/02/2020 09:30</li><li><a href="load_data_eps.html" class="code" title="function [table_to_use] = load_data_eps(ep,dataSet,dataKind,dataNumber)">load_data_eps</a>	19/04/2020 15:45</li><li><a href="log_LH_evaluation.html" class="code" title="function [value] = log_LH_evaluation(batch_complete, alpha, theta_0, dt) % 03/02/2020 19:42">log_LH_evaluation</a>	</li><li><a href="log_LH_evaluation_L.html" class="code" title="function [value] = log_LH_evaluation_L(batch_complete, theta0, alpha, dt) % 03/02/2020 19:42">log_LH_evaluation_L</a>	</li><li><a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="mean_regression_eps.html" class="code" title="function [val, accum] = mean_regression_eps(error, dt) % 16/03/2020 11:08">mean_regression_eps</a>	</li><li><a href="new_batch_fixed.html" class="code" title="function [Table_Training, new_bat] = new_batch_fixed(Table_Training, batch_size, N)">new_batch_fixed</a>	11/02/2020 09:35</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 close all;
0002 clear all;
0003 clc;
0004 
0005 <span class="comment">% Lamperti has no sense here. I wanted to plot it as a function of the</span>
0006 <span class="comment">% parameters. Still, as the Lamperti transform also depends on the</span>
0007 <span class="comment">% parameters, the data set changed in each evaluation of the Likelihood,</span>
0008 <span class="comment">% which has no sense. See plotLamperti.m.</span>
0009 
0010 likelihood    = <span class="string">'normal'</span>; <span class="comment">% 'normal' or 'lamperti'.</span>
0011 <span class="comment">% dataSet can be AWSTP, MTLOG or UTEP5.</span>
0012 dataSet = <span class="string">'MTLOG'</span>;
0013 <span class="comment">% epsilon can be 0.035 (B), 0.018 (A) or 0.028 (C).</span>
0014 epsilon       = 0.018;
0015 <span class="comment">% dataKind can be classic or comparable.</span>
0016 dataKind   = <span class="string">'comparable'</span>;
0017 dataNumber = <span class="string">'testing'</span>;
0018 [Ta_Tra_Comp] = <a href="load_data_eps.html" class="code" title="function [table_to_use] = load_data_eps(ep,dataSet,dataKind,dataNumber)">load_data_eps</a>(epsilon,dataSet,dataKind,dataNumber);
0019 
0020 <span class="comment">% AWSTP) (B)</span>
0021 <span class="comment">% T_0 = 1.42, Alpha = 0.069, prod = 0.0980, f = -36753.</span>
0022 <span class="comment">% AIC = -73502, BIA = -73487.</span>
0023 <span class="comment">% MTLOG) (A)</span>
0024 <span class="comment">% T_0 = 1.93, Alpha = 0.050, prod = 0.0965, f = -36852.</span>
0025 <span class="comment">% AIC = -73700, BIA = -73685.</span>
0026 <span class="comment">% UTEP5) (B)</span>
0027 <span class="comment">% T_0 = 1.38, Alpha = 0.078, prod = 0.1076, f = -36261.</span>
0028 <span class="comment">% AIC = -72518, BIA = -72503.</span>
0029 
0030 Table_Training = Ta_Tra_Comp; <span class="comment">% We copy it so we can modify it.</span>
0031 
0032 Date              = Ta_Tra_Comp.Date;
0033 Time              = Ta_Tra_Comp.Time;
0034 Forecast          = Ta_Tra_Comp.Forecast;
0035 Forecast_Dot      = Ta_Tra_Comp.Forecast_Dot;
0036 Real_ADME         = Ta_Tra_Comp.Real_ADME;
0037 Error             = Ta_Tra_Comp.Error;
0038 Error_Transitions = Ta_Tra_Comp.Error_Transitions;
0039 Lamparti_Data     = Ta_Tra_Comp.Error_Lamp;
0040 Lamparti_Tran     = Ta_Tra_Comp.Error_Lamp_Transitions;
0041 
0042 dt             = Time(1,2);
0043 [M, N_ini]     = size(Forecast);
0044 N              = N_ini - 1; <span class="comment">% We have N_ini measurements but N samples.</span>
0045 
0046 num_days = height(Ta_Tra_Comp); <span class="comment">% Maximum 127 for MTLOG.</span>
0047 [Table_Training, batch] = <a href="new_batch_fixed.html" class="code" title="function [Table_Training, new_bat] = new_batch_fixed(Table_Training, batch_size, N)">new_batch_fixed</a>(Table_Training,num_days,N);
0048 
0049 <span class="comment">%% Initial parameters:</span>
0050 
0051 est           = <a href="initial_guess.html" class="code" title="function [est] = initial_guess(real_prod, M, N, dt)">initial_guess</a>(Real_ADME, M, N, dt);
0052 gamma         = 0.35; 
0053 samples_gamma = <a href="create_samples_minus_eps.html" class="code" title="function [minus_eps_samples] = create_samples_minus_eps(Forecast, Error, gamma)">create_samples_minus_eps</a>(Forecast, Error, gamma);
0054 theta_ini     = <a href="mean_regression_eps.html" class="code" title="function [val, accum] = mean_regression_eps(error, dt) % 16/03/2020 11:08">mean_regression_eps</a>(samples_gamma, dt);
0055 alpha_ini     = est/theta_ini;
0056 <span class="comment">% AWSTP) (B)</span>
0057 <span class="comment">% T_0 = 1.0657, Alpha = 0.1039, prod = 0.1108.</span>
0058 <span class="comment">% MTLOG) (A)</span>
0059 <span class="comment">% T_0 = 1.5441, Alpha = 0.0717, prod = 0.1108.</span>
0060 <span class="comment">% UTEP5) (B)</span>
0061 <span class="comment">% T_0 = 1.1625, Alpha = 0.0953, prod = 0.1108.</span>
0062 
0063 <span class="comment">%% Log-Likelihood plot:</span>
0064 
0065 val = [];
0066 
0067 <span class="keyword">if</span> strcmp(likelihood,<span class="string">'normal'</span>)
0068     vec_theta = 0.1:0.01:2;
0069     vec_alpha = 0.01:0.001:0.5;
0070     num_divs  = 10000;
0071 <span class="keyword">elseif</span> strcmp(likelihood,<span class="string">'lamperti'</span>)
0072     ini_theta = 10;
0073     ini_alpha = 10;
0074     len_theta = 100;
0075     len_alpha = 100;
0076     div_theta = 10; 
0077     div_alpha = 100;
0078     num_divs  = 100;
0079 <span class="keyword">end</span>
0080 
0081 <span class="keyword">for</span> i = 1:length(vec_theta)
0082 
0083     vec = ones(1,length(vec_alpha));
0084 
0085     parfor j = 1:length(vec_alpha)
0086         
0087         theta_0 = vec_theta(i);
0088         alpha   = vec_alpha(j);
0089         
0090         <span class="keyword">if</span> strcmp(likelihood,<span class="string">'normal'</span>)
0091             
0092             batch_complete = <a href="batch_with_theta.html" class="code" title="function [batch_theta] = batch_with_theta(batch, alpha, theta_0) % 09/02/2020 18:51">batch_with_theta</a>(batch, alpha, theta_0);
0093             vec(j) = -<a href="log_LH_evaluation.html" class="code" title="function [value] = log_LH_evaluation(batch_complete, alpha, theta_0, dt) % 03/02/2020 19:42">log_LH_evaluation</a>(batch_complete, alpha, theta_0, dt);
0094             
0095         <span class="keyword">elseif</span> strcmp(likelihood,<span class="string">'lamperti'</span>)
0096             
0097             batch_complete = <a href="batch_with_theta_L.html" class="code" title="function [batch_theta] = batch_with_theta_L(batch, alpha, theta_0) % 29/03/2020 19:43">batch_with_theta_L</a>(batch, alpha, theta_0);
0098             vec(j) = -<a href="log_LH_evaluation_L.html" class="code" title="function [value] = log_LH_evaluation_L(batch_complete, theta0, alpha, dt) % 03/02/2020 19:42">log_LH_evaluation_L</a>(batch_complete, theta_0, alpha, dt);
0099             
0100         <span class="keyword">end</span>
0101         
0102     <span class="keyword">end</span>
0103 
0104     val(i,:) = vec(:);
0105 
0106     disp(num2str(i/length(vec_theta)*100));
0107 
0108 <span class="keyword">end</span>
0109 
0110 <span class="keyword">if</span> strcmp(dataNumber,<span class="string">'training'</span>)
0111 
0112     theta_0_opt_1 = 1.278;
0113     alpha_opt_1   = 0.076;
0114     theta_0_opt_2 = 1.577;
0115     alpha_opt_2   = 0.062;
0116     theta_0_opt_3 = 1.544;
0117     alpha_opt_3   = 0.063;
0118 
0119 <span class="keyword">elseif</span> strcmp(dataNumber,<span class="string">'testing'</span>)
0120     
0121     theta_0_opt_1 = 1.642;
0122     alpha_opt_1   = 0.0542;
0123     theta_0_opt_2 = 1.632;
0124     alpha_opt_2   = 0.0545;
0125     theta_0_opt_3 = 1.963;
0126     alpha_opt_3   = 0.0454;
0127     
0128 <span class="keyword">end</span>
0129 
0130 <span class="comment">% To save the matrix with the evaluations, we use:</span>
0131 <span class="comment">% save([pwd '/Results/likelihood/',likelihood,'/Log-Likelihood.mat'],'val');</span>
0132 <span class="comment">% To load the matrix with the evaluations, we use:</span>
0133 <span class="comment">% load([pwd '/Results/likelihood/',likelihood,'/Log-Likelihood.mat'],'val');</span>
0134 
0135 <span class="comment">% To save the matrix with the evaluations, we use:</span>
0136 <span class="comment">% save([pwd '/Results/likelihood/',likelihood,'/Log-Likelihood_testing.mat'],'val');</span>
0137 <span class="comment">% To load the matrix with the evaluations, we use:</span>
0138 <span class="comment">% load([pwd '/Results/likelihood/',likelihood,'/Log-Likelihood_testing.mat'],'val');</span>
0139 
0140 val_norm = (val-min(min(val)))/max(max((val-min(min(val)))));
0141 
0142 minMatrix = min(val(:));
0143 [row,col] = find(val==minMatrix);
0144 theta_0_opt_4 = vec_theta(row);
0145 alpha_opt_4   = vec_alpha(col);
0146 
0147 figure(<span class="string">'Renderer'</span>, <span class="string">'painters'</span>, <span class="string">'Position'</span>, [10 10 900 600])
0148 hold on;
0149 [X,Y] = meshgrid(vec_theta,vec_alpha);
0150 <span class="comment">% contourf(X,Y,val',num_divs); % colorbar;</span>
0151 contourf(X,Y,val',[-37737 -37735 -37717 -37697 -37677 -37657]); colorbar;
0152 <span class="comment">% contourf(X,Y,val'); colorbar;</span>
0153 xlabel(<span class="string">'$\theta_0$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>);
0154 ylabel(<span class="string">'$\alpha$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>);
0155 title([<span class="string">'Negative Log-Likelihoog for '</span>,num2str(num_days),<span class="string">' days'</span>]);
0156 <span class="keyword">if</span> strcmp(likelihood,<span class="string">'normal'</span>)
0157     plot(theta_ini,alpha_ini,<span class="string">'-p'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'red'</span>,<span class="string">'MarkerSize'</span>,12);
0158     plot(theta_0_opt_1,alpha_opt_1,<span class="string">'-p'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'cyan'</span>,<span class="string">'MarkerSize'</span>,12);
0159     plot(theta_0_opt_2,alpha_opt_2,<span class="string">'-p'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'green'</span>,<span class="string">'MarkerSize'</span>,12);
0160     plot(theta_0_opt_3,alpha_opt_3,<span class="string">'-p'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'yellow'</span>,<span class="string">'MarkerSize'</span>,12);
0161     plot(theta_0_opt_4,alpha_opt_4,<span class="string">'-p'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'white'</span>,<span class="string">'MarkerSize'</span>,12);
0162     legend(<span class="string">'Level sets'</span>,<span class="string">'Initial guess'</span>,<span class="string">'Optimal value (fminsearch)'</span>,<span class="keyword">...</span>
0163         <span class="string">'Optimal value (fmincon)'</span>,<span class="string">'Optimal value (fminunc)'</span>,<span class="string">'Optimal value (evaluations)'</span>);
0164 <span class="keyword">elseif</span> strcmp(likelihood,<span class="string">'lamperti'</span>)
0165     legend(<span class="string">'Level sets'</span>);
0166 <span class="keyword">end</span>
0167 pause(0.1);
0168 <span class="comment">% To save the plot and change the fonts size, we use:</span>
0169 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(gca,<span class="string">'FontSize'</span>,16);
0170 <span class="keyword">if</span> strcmp(dataNumber,<span class="string">'training'</span>)
0171     saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood'</span>],<span class="string">'epsc'</span>);
0172     saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood'</span>],<span class="string">'bmp'</span>);
0173     saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood'</span>],<span class="string">'png'</span>);
0174 <span class="keyword">elseif</span> strcmp(dataNumber,<span class="string">'testing'</span>)
0175     saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood_testing'</span>],<span class="string">'epsc'</span>);
0176     saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood_testing'</span>],<span class="string">'bmp'</span>);
0177     saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood_testing'</span>],<span class="string">'png'</span>);
0178 <span class="keyword">end</span>
0179 
0180 <span class="comment">%% Plot with zoom:</span>
0181 
0182 figure;
0183 hold on;
0184 [X,Y] = meshgrid(vec_theta(41:end),vec_alpha(1:91));
0185 contourf(X,Y,val((41:end),1:91)',num_divs); colorbar;
0186 xlabel(<span class="string">'$\theta_0$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>);
0187 ylabel(<span class="string">'$\alpha$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>);
0188 title([<span class="string">'Negative Log-Likelihoog for '</span>,num2str(num_days),<span class="string">' days'</span>]);
0189 legend(<span class="string">'Level sets'</span>);
0190 saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood_Zoom'</span>],<span class="string">'epsc'</span>);
0191 
0192 <span class="comment">%% Plot with the important line:</span>
0193 
0194 alpha_1 = 0.081./vec_theta;
0195 alpha_2 = 0.083./vec_theta;
0196 alpha_3 = 0.085./vec_theta;
0197 
0198 figure;
0199 hold on;
0200 contourf(X,Y,val',num_divs);
0201 plot(vec_theta,alpha_1,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,1)
0202 plot(vec_theta,alpha_2,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,1);
0203 plot(vec_theta,alpha_3,<span class="string">'Color'</span>,[0.8500 0.3250 0.0980],<span class="string">'LineWidth'</span>,1);
0204 ylim([min(vec_alpha) max(vec_alpha)]);
0205 xlabel(<span class="string">'$\theta_0$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>);
0206 ylabel(<span class="string">'$\alpha$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>);
0207 title([<span class="string">'Negative Log-Likelihoog for '</span>,num2str(num_days),<span class="string">' days'</span>]);
0208 legend(<span class="string">'Level sets'</span>,<span class="string">'Curve $\theta_0\alpha=0.081$'</span>,<span class="keyword">...</span>
0209     <span class="string">'Curve $\theta_0\alpha=0.083$'</span>,<span class="string">'Curve $\theta_0\alpha=0.085$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'Latex'</span>);
0210 saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood_Line'</span>],<span class="string">'epsc'</span>);
0211 
0212 pause(0.1);
0213 
0214 parfor i = 1:length(alpha_1)
0215     
0216     disp(num2str(i/length(alpha_1)*100));
0217     
0218     batch_complete = <a href="batch_with_theta.html" class="code" title="function [batch_theta] = batch_with_theta(batch, alpha, theta_0) % 09/02/2020 18:51">batch_with_theta</a>(batch, alpha_1(i), vec_theta(i));
0219     vec_1(i) = -<a href="log_LH_evaluation.html" class="code" title="function [value] = log_LH_evaluation(batch_complete, alpha, theta_0, dt) % 03/02/2020 19:42">log_LH_evaluation</a>(batch_complete, alpha_1(i), vec_theta(i), dt);
0220     
0221     batch_complete = <a href="batch_with_theta.html" class="code" title="function [batch_theta] = batch_with_theta(batch, alpha, theta_0) % 09/02/2020 18:51">batch_with_theta</a>(batch, alpha_2(i), vec_theta(i));
0222     vec_2(i) = -<a href="log_LH_evaluation.html" class="code" title="function [value] = log_LH_evaluation(batch_complete, alpha, theta_0, dt) % 03/02/2020 19:42">log_LH_evaluation</a>(batch_complete, alpha_2(i), vec_theta(i), dt);
0223     
0224     batch_complete = <a href="batch_with_theta.html" class="code" title="function [batch_theta] = batch_with_theta(batch, alpha, theta_0) % 09/02/2020 18:51">batch_with_theta</a>(batch, alpha_3(i), vec_theta(i));
0225     vec_3(i) = -<a href="log_LH_evaluation.html" class="code" title="function [value] = log_LH_evaluation(batch_complete, alpha, theta_0, dt) % 03/02/2020 19:42">log_LH_evaluation</a>(batch_complete, alpha_3(i), vec_theta(i), dt);
0226     
0227 <span class="keyword">end</span>
0228 
0229 figure;
0230 plot(vec_theta,vec_1,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2);
0231 hold on;
0232 plot(vec_theta,vec_2,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2);
0233 plot(vec_theta,vec_3,<span class="string">'Color'</span>,[0.8500 0.3250 0.0980],<span class="string">'LineWidth'</span>,2);
0234 title([<span class="string">'Negative Log-Likelihoog for '</span>,num2str(num_days),<span class="string">' days'</span>]);
0235 grid minor;
0236 xlabel(<span class="string">'$\theta_0$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>);
0237 ylabel(<span class="string">'Negative Log-Likelihoog evaluation'</span>);
0238 legend(<span class="string">'Curve $\theta_0\alpha=0.081$'</span>,<span class="string">'Curve $\theta_0\alpha=0.083$'</span>,<span class="keyword">...</span>
0239     <span class="string">'Curve $\theta_0\alpha=0.085$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'Latex'</span>);
0240 xlim([min(vec_theta) max(vec_theta)]);
0241 saveas(gcf,[pwd <span class="string">'/Results/likelihood/'</span>,likelihood,<span class="string">'/Log-Likelihood_Evaluations'</span>],<span class="string">'epsc'</span>);</pre></div>
<hr><address>Generated on Sat 15-Aug-2020 22:53:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>