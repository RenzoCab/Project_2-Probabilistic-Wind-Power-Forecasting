<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of path_simulator_OPT_forSuppMat</title>
  <meta name="keywords" content="path_simulator_OPT_forSuppMat">
  <meta name="description" content="Supplementary Material for the Wind-Power Paper.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">.</a> &gt; path_simulator_OPT_forSuppMat.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for .&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>path_simulator_OPT_forSuppMat
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Supplementary Material for the Wind-Power Paper.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Supplementary Material for the Wind-Power Paper.
 Author: Renzo Caballero
 KAUST: King Abdullah University of Science and Technology
 email: Renzo.CaballeroRosas@kaust.edu.sa CaballeroRenzo@hotmail.com
 Website: https://orcid.org/0000-0003-3220-0923.
 July 2020; Last revision: 19/07/2020.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>	ciplot(lower,upper)</li><li><a href="load_data_eps_test.html" class="code" title="function [Table_Testing_Complete] = load_data_eps_test(ep,dataSet,dataKind,set_type)">load_data_eps_test</a>	18/03/2020 10:41</li><li><a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="sde_FE.html" class="code" title="function sim_path_f = sde_FE(sim_path_i,alpha,theta_0,Theta_t,dt,P,P_dot) % 02/02/2020 18:28">sde_FE</a>	SDE for X_t.</li><li><a href="theta_t.html" class="code" title="function [theta_t] = theta_t(theta_0, alpha, pe, pe_dot) % 13/03/2020 19:09">theta_t</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_download"></a>DOWNLOAD <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<p><a href="path_simulator_OPT_forSuppMat.m">path_simulator_OPT_forSuppMat.m</a></p>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Supplementary Material for the Wind-Power Paper.</span>
0002 <span class="comment">% Author: Renzo Caballero</span>
0003 <span class="comment">% KAUST: King Abdullah University of Science and Technology</span>
0004 <span class="comment">% email: Renzo.CaballeroRosas@kaust.edu.sa CaballeroRenzo@hotmail.com</span>
0005 <span class="comment">% Website: https://orcid.org/0000-0003-3220-0923.</span>
0006 <span class="comment">% July 2020; Last revision: 19/07/2020.</span>
0007 
0008 close all;
0009 clear all;
0010 clc;
0011 
0012 <span class="comment">% We fix the seed:</span>
0013 rng(1);
0014 
0015 <span class="comment">% dataSet can be AWSTP (B), MTLOG (A) or UTEP5 (C).</span>
0016 dataSet  = <span class="string">'MTLOG'</span>;
0017 <span class="comment">% epsilon can be 0.035 (B), 0.020 (A) or 0.028 (C).</span>
0018 epsilon  = 0.020;
0019 <span class="comment">% dataKind can be classic or comparable.</span>
0020 dataKind = <span class="string">'comparable'</span>;
0021 set_type = <span class="string">'testing'</span>; <span class="comment">% 'testing' or 'training'.</span>
0022 
0023 types    = {<span class="string">'testing'</span>,<span class="string">'training'</span>};
0024 options  = {0,1};
0025 angle    = 45;
0026 
0027 <span class="keyword">for</span> y = 1:2
0028     
0029     <span class="keyword">for</span> w = 1:2
0030 
0031         quantil  = options{w};
0032         set_type = types{y};
0033         
0034         sim_path = [];
0035         
0036         Table_Testing_Complete = <a href="load_data_eps_test.html" class="code" title="function [Table_Testing_Complete] = load_data_eps_test(ep,dataSet,dataKind,set_type)">load_data_eps_test</a>(epsilon,dataSet,dataKind,set_type);
0037         
0038         <span class="comment">% set(0,'defaultAxesFontSize',18);</span>
0039         save     = 1;
0040         delta    = 13; <span class="comment">% The time is delta*10 minutes.</span>
0041         xlimit   = 1; <span class="comment">% If this in 1, the plots start at time 0. Otherwise, at -delta.</span>
0042         norm_lim = 0; <span class="comment">% If 1, x=[0,1], if 0, x=[1PM 1PM].</span>
0043         <span class="comment">% Also, when norm_lim = 0, we check the real accuracy for the bands.</span>
0044         new_time = [13-(1/6)*delta:1/6:37]/24;
0045         counting   = zeros(4,1);
0046         counting_2 = zeros(4,1);
0047 
0048         <span class="keyword">if</span> quantil
0049             numPaths = 5000;
0050         <span class="keyword">else</span>
0051             numPaths = 5;
0052         <span class="keyword">end</span>
0053 
0054         <span class="keyword">if</span>  strcmp(set_type,<span class="string">'testing'</span>) <span class="comment">% We do inference with training.</span>
0055             theta_0 = 1.93;
0056             alpha   = 0.05;
0057         <span class="keyword">elseif</span> strcmp(set_type,<span class="string">'training'</span>) <span class="comment">% We do inference with testing.</span>
0058             theta_0 = 1.59;
0059             alpha   = 0.056;
0060         <span class="keyword">end</span>
0061 
0062         d  = Table_Testing_Complete.Date;
0063         p  = Table_Testing_Complete.Forecast;
0064         t  = Table_Testing_Complete.Time(1,:);
0065         x  = Table_Testing_Complete.Real_ADME;
0066         v  = Table_Testing_Complete.Error;
0067         dt = t(2); <span class="comment">% This is the default dt. I will choose a smaller one.</span>
0068         <span class="comment">% If the dt is not small enough, we always scape from [0 1].</span>
0069         dt = dt/1;
0070 
0071         figure(10);
0072 
0073         minus_t = linspace(-delta*dt,-dt,delta);
0074         <span class="keyword">if</span> norm_lim == 1
0075             exten_t = [minus_t,t];
0076         <span class="keyword">elseif</span> norm_lim == 0
0077             exten_t = new_time;
0078             t       = [13:1/6:37]/24;
0079             t_ticks = [13:2:37]/24;
0080         <span class="keyword">end</span>
0081 
0082         <span class="keyword">for</span> i = 1 : height(Table_Testing_Complete)
0083 
0084             X = x(i,:);
0085             P = p(i,:);
0086             <span class="comment">% All of them show similar results:</span>
0087             P_exten_linear = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'linear'</span>,<span class="string">'extrap'</span>);
0088             P_exten_pchip  = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'pchip'</span>,<span class="string">'extrap'</span>);
0089             P_exten_spline = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'spline'</span>,<span class="string">'extrap'</span>);
0090             P_exten_makima = interp1([0 6*dt],[P(1) P(6)],minus_t,<span class="string">'makima'</span>,<span class="string">'extrap'</span>);
0091 
0092             P        = [P_exten_linear,P]; <span class="comment">% We extend the forecast.</span>
0093             <span class="keyword">for</span> j = 1:length(P)
0094                 P(j) = max(P(j),epsilon);
0095                 P(j) = min(P(j),1-epsilon);
0096             <span class="keyword">end</span>
0097             P_dot   = (-P(1:end-1) + P(2:end)) / dt; <span class="comment">% This starts at 1 end ends at (end - 1).</span>
0098             <span class="keyword">for</span> j = 1:length(P)-1
0099                 Theta_t(j) = <a href="theta_t.html" class="code" title="function [theta_t] = theta_t(theta_0, alpha, pe, pe_dot) % 13/03/2020 19:09">theta_t</a>(theta_0, alpha, P(j), P_dot(j));
0100             <span class="keyword">end</span>
0101 
0102             <span class="comment">% We assume that the forecast is perfect one hour before it starts.</span>
0103             sim_path(1:numPaths,1) = P(1);
0104 
0105             <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(0,<span class="string">'CurrentFigure'</span>,10); clf(10);
0106             J = plot(exten_t,P,<span class="string">'k'</span>); J.LineWidth = 2;
0107             hold on;
0108             J = plot(t,X,<span class="string">'b'</span>); J.LineWidth = 2;
0109             xlim([min(exten_t) max(exten_t)]); ylim([0 1]); grid minor;
0110         <span class="comment">%     xlabel('Time'), ylabel('Power');</span>
0111             date = d(i);
0112             date_format = datetime(date{1},<span class="string">'InputFormat'</span>,<span class="string">'yyyyMMdd'</span>);
0113             date_format_next = date_format + days(1);
0114             title([datestr(date_format),<span class="string">' and '</span>,datestr(date_format_next)]);
0115 
0116             <span class="keyword">for</span> k = 1:numPaths
0117                 <span class="keyword">for</span> j = 1 : length(exten_t)-1
0118                     sim_path(k,j+1) = <a href="sde_FE.html" class="code" title="function sim_path_f = sde_FE(sim_path_i,alpha,theta_0,Theta_t,dt,P,P_dot) % 02/02/2020 18:28">sde_FE</a>(sim_path(k,j),alpha,theta_0,Theta_t(j),dt,P(j),P_dot(j));
0119                     <span class="keyword">if</span> sim_path(k,j+1) &gt; 1
0120                         sim_path(k,j+1) = 1;
0121                     <span class="keyword">elseif</span> sim_path(k,j+1) &lt; 0
0122                         sim_path(k,j+1) = 0;
0123                     <span class="keyword">end</span>
0124                 <span class="keyword">end</span>
0125             <span class="keyword">end</span>
0126 
0127             <span class="keyword">if</span> quantil == 1
0128 
0129                 <span class="keyword">for</span> k = 1:length(sim_path(1,:))
0130                     quant(k,:) = quantile(sim_path(:,k),[0.01 0.05 0.25 0.75 0.95 0.99]);
0131                     men(k)     = mean(sim_path(:,k));
0132                 <span class="keyword">end</span>
0133                 <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(0,<span class="string">'CurrentFigure'</span>,10); clf(10); hold on;
0134                 <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,1),quant(:,6),exten_t,[153 255 153]/255)
0135                 <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,2),quant(:,5),exten_t,[153 255 255]/255)
0136                 <a href="ciplot.html" class="code" title="function ciplot(lower,upper,x,colour,alpha);">ciplot</a>(quant(:,3),quant(:,4),exten_t,[153 153 255]/255)
0137                 J = plot(exten_t,P,<span class="string">'k'</span>); J.LineWidth = 2;
0138                 J = plot(t,X,<span class="string">'b'</span>); J.LineWidth = 2;
0139                 legend({<span class="string">'99% confidence interval'</span>, <span class="string">'90% confidence interval'</span>, <span class="string">'50% confidence interval'</span>,<span class="keyword">...</span>
0140                     <span class="string">'Forecast'</span>, <span class="string">'Real production'</span>});
0141 
0142                 xticks(t_ticks);
0143                 datetick(<span class="string">'x'</span>,<span class="string">'HHPM'</span>,<span class="string">'keepticks'</span>);
0144                 xtickangle(angle);
0145 
0146                 <span class="keyword">if</span> xlimit
0147                     xlim([min(t_ticks) max(t_ticks)]);
0148                 <span class="keyword">else</span>
0149                     xlim([min(new_time) max(new_time)]);
0150                 <span class="keyword">end</span>
0151 
0152                 ylim([0 1]); grid minor;
0153         <span class="comment">%         xlabel('Time'), ylabel('Power');</span>
0154                 box;
0155                 date = d(i);
0156                 date_format = datetime(date{1},<span class="string">'InputFormat'</span>,<span class="string">'yyyyMMdd'</span>);
0157                 date_format_next = date_format + days(1);
0158                 title([datestr(date_format),<span class="string">' and '</span>,datestr(date_format_next)]);
0159                 <span class="keyword">if</span> save == 1
0160                     saveas(gcf,[pwd <span class="string">'/Results/supplementary_material/forecast_from_'</span>,set_type,<span class="string">'/bands/'</span>,num2str(i)],<span class="string">'epsc'</span>);
0161                 <span class="keyword">end</span>
0162 
0163             <span class="keyword">else</span>
0164 
0165                 plot(exten_t,sim_path,<span class="string">'r'</span>);
0166                 legend(<span class="string">'Forecast'</span>,<span class="string">'Real Production'</span>,<span class="string">'Simulations'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
0167 
0168                 xticks(t_ticks);
0169                 datetick(<span class="string">'x'</span>,<span class="string">'HHPM'</span>,<span class="string">'keepticks'</span>);
0170                 xtickangle(angle);
0171 
0172                 pause(0.1); box;
0173                 <span class="keyword">if</span> xlimit
0174                     xlim([min(t_ticks) max(t_ticks)]);
0175                 <span class="keyword">else</span>
0176                     xlim([min(new_time) max(new_time)]);
0177                 <span class="keyword">end</span>
0178 
0179                 box;
0180                 <span class="keyword">if</span> save == 1
0181                     saveas(gcf,[pwd <span class="string">'/Results/supplementary_material/forecast_from_'</span>,set_type,<span class="string">'/paths/'</span>,num2str(i)],<span class="string">'epsc'</span>);
0182                 <span class="keyword">end</span>
0183 
0184             <span class="keyword">end</span>
0185 
0186             pause(0.1);
0187 
0188         <span class="keyword">end</span>
0189 
0190     <span class="keyword">end</span>
0191     
0192 <span class="keyword">end</span>
0193 
0194 copyfile(<span class="string">'Results/supplementary_material'</span>, <span class="string">'../LaTeX_Code/Paper/Supplementary Material/plots'</span>);</pre></div>
<hr><address>Generated on Sun 19-Jul-2020 13:36:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>